---
title: "Preprocessing with Default Settings"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{default-preprocessing}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
## Basics 
The data were collected on MATLAB environment in this project. Therefore, the 
first thing to do is to reorganize the files and to get ready for the further steps.

### MATLAB data structure

Our .mat file includes a MATLAB structure named as log. Besides the other 
variable, its forth component is a struct containing the key events and fifth 
component is a struct containing the experiment info, as the following:

```
raw_data
  --raw_data.key
    --raw_data.key.perceptKeys  # key codes of instructed keys  [key_1, key_2]
    --raw_data.key.perceptNames # key names of instructed keys  {key_1, key_2}
    --raw_data.key.idDown       # key codes of pressed keys     [nx1 double]
    --raw_data.key.timeDown     # time points for pressed keys  [nx1 double]
    --raw_data.key.idUp         # key codes of released keys    [nx1 double]
    --raw_data.key.timeUp       # time points for released keys [nx1 double]
  --raw_data.exp
    --raw_data.exp.trialStartTime # [trial_1, trial_2]
    --raw_data.exp.trialEndTime   # [trial_1, trial_2]
```

We saved separate .mat files for each experimental run by naming the file as:
ExperimentName_s###_session#_run#_date.mat

```{r setup}
library(preprivalry)
```

## Example

The subject data can be preprocessed by using only one function:

```{r prep-example}
library(preprivalry)
## basic example for preprocessing of subject data
directory <- paste(getwd(), '/tests', sep='')
exp_list <- c('RivalryGratings','RivalryImages')
subj <- 's001'
ses <- 1
data <- preprocessing_subject(directory,exp_list,subj,ses)
```

The output can be saved also as an excel file after organizing as a table:
```{r table-example}
library(preprivalry)
## basic example for saving as csv
directory <- paste(getwd(), '/tests',sep='')
output_file <- paste(directory, '/data.csv', sep='')
exp_list <- c('RivalryGratings','RivalryImages')
subj <- 's001'
ses <- 1
raw_data <- read_rivdata(directory,exp_list[1],subj,'session1')
percept_keys <- rbind(raw_data[["log"]][[4]][[1]],
                      c(raw_data[["log"]][[4]][[2]][[1]][[1]],raw_data[["log"]][[4]][[2]][[2]][[1]]))
data <- preprocessing_subject(directory,exp_list,subj,ses)
data <- reorganize_as_table(data)
```

## First step of preprocessing
First, read the data from a .mat file of a single run. `read_rivdata()` creates
the file name and read the defined file. Then, extract the trial data. 
`extract_exp()` 

It reads only a part of data due to 
compatibility issues. Therefore, concatanate the record of percept keys after
reading the data. 


```{r table-example}
library(preprivalry)
## basic example for saving as csv
directory <- paste(getwd(), '/tests',sep='')
output_file <- paste(directory, '/data.csv', sep='')
exp_list <- c('RivalryGratings','RivalryImages')
subj <- 's001'
ses <- 1
raw_data <- read_rivdata(directory,exp_list[1],subj,'session1')
percept_keys <- rbind(raw_data[["log"]][[4]][[1]],
                      c(raw_data[["log"]][[4]][[2]][[1]][[1]],raw_data[["log"]][[4]][[2]][[2]][[1]]))
data <- preprocessing_subject(directory,exp_list,subj,ses)
data <- reorganize_as_table(data)
```
